---
- name: Inclusion des variables OS specific
  include_vars: "{{ ansible_distribution }}{{ ansible_distribution_major_version }}.yml"

- name: Installation des packages lxd
  apt:
    name: "{{ item }}"
    state: latest
    default_release: "{{ lxd_deploy_apt_default_release }}"
    update_cache: yes
  with_items:
    - lxd
    - lxd-client
    - yum

- name: Installation des requirements
  pip:
    name: "{{ item }}"
    state: latest
  with_items:
    - jmespath

- name: Configuration des networks
  lxd_network:
    name: "{{ item.name }}"
    config: "{{ item.config }}"
    description: "{{ item.description }}"
  with_items: "{{ lxd_deploy_networks }}"
    
- name: Cr√©ation des containers
  lxd_container:
    name: "{{ item.name }}"
    state: started
    source:
      type: image
      mode: pull
      server: https://images.linuxcontainers.org
      protocol: lxd
      alias: "{{ item.alias }}"
    profiles: ["default"]
    wait_for_ipv4_addresses: true
  with_items: "{{ lxd_deploy_containers }}"
  register: add_lxd_container

