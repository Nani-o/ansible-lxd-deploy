---
- name: Get lxd version
  shell: "lxd --version"
  register: lxd_version_result
  changed_when: false

- name: Configuration for Feature version
  include_tasks: configure-feature.yml
  when: "lxd_version_result.stdout | version_compare('2.20', '>=')"

- name: Configuration for LTS version
  include_tasks: configure-lts.yml
  when: "lxd_version_result.stdout | version_compare('2.20', '<=')"

- name: Create LXD profiles
  lxd_profile:
    name: "{{ item.name }}"
    state: "present"
    config: "{{ item.config }}"
    devices: "{{ item.devices }}"
    description: "{{ item.description }}"
  with_items: "{{ lxd_profiles }}"
  when: "lxd_profiles is defined"
