---
- block:
# ToDo : Change version checking
    - name: temp
      set_fact:
        lxd_temp_version: 3.0.1

    - name: Wait for socket file
      wait_for:
        path: /var/snap/lxd/common/lxd/unix.socket
        state: present
        timeout: 180

    - name: Configuration for Feature version
      include_tasks: configure-feature.yml
      when: "lxd_temp_version | version_compare('2.20', '>=')"

    - name: Configuration for LTS version
      include_tasks: configure-lts.yml
      when: "lxd_temp_version | version_compare('2.20', '<=')"

    - name: Create LXD profiles
      lxd_profile:
        name: "{{ item.name }}"
        state: "present"
        config: "{{ item.config }}"
        devices: "{{ item.devices }}"
        description: "{{ item.description }}"
        url: "{{ lxd_url }}"
      with_items: "{{ lxd_profiles }}"
      when: "lxd_profiles is defined"
  tags: lxd_config
